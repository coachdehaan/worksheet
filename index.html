<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Team Worksheet</title>
    <script src="https://www.gstatic.com/firebasejs/9.6.1/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.6.1/firebase-database-compat.js"></script>
    <style>
      .selected {
        border: 2px solid;
      }
      .answered {
        background-color: green;
      }
      .wrong-answer {
        background-color: red;
      }
    </style>
  </head>
  <body>
    <div id="team-selection">
      <button id="red-team">Red Team</button>
      <button id="blue-team">Blue Team</button>
      <select id="student-name">
        <option value="">Select student</option>
        <!-- Add student names here -->
        <option value="John">John</option>
        <option value="Jane">Jane</option>
        <option value="Mike">Mike</option>
      </select>
    </div>

    <div id="worksheet">
      <!-- Fill-in-the-blank questions with word bank dropdowns go here -->
      
    </div>

    <div id="results">
      <h3>Individual Scores</h3>
      <ul id="individual-scores"></ul>
      <h3>Team Scores</h3>
      <span>Red Team: <span id="red-score">0</span></span>
      <span>Blue Team: <span id="blue-score">0</span></span>
    </div>

    <script type="module">
      import { initializeApp } from "https://www.gstatic.com/firebasejs/9.18.0/firebase-app.js";
      import { getDatabase, ref, set, onValue, push } from "https://www.gstatic.com/firebasejs/9.18.0/firebase-database.js";
      const questions = [  {    question: "The capital of France is ___",    correctAnswer: "Paris",    wordBank: ["London", "Paris", "Madrid", "Berlin"]
  },
  {
    question: "The largest planet in our solar system is ___",
    correctAnswer: "Jupiter",
    wordBank: ["Venus", "Mars", "Jupiter", "Saturn"]
  },
  {
    question: "The author of 'The Hobbit' is ___",
    correctAnswer: "J.R.R. Tolkien",
    wordBank: ["J.K. Rowling", "George R.R. Martin", "J.R.R. Tolkien", "Stephen King"]
  }
];

      
const firebaseConfig = {
  apiKey: "AIzaSyC6toyds2tLzyfiINLUXgPeEgSDU2WhwkI",
  authDomain: "worksheet-9f4d8.firebaseapp.com",
  databaseURL: "https://worksheet-9f4d8-default-rtdb.firebaseio.com",
  projectId: "worksheet-9f4d8",
  storageBucket: "worksheet-9f4d8.appspot.com",
  messagingSenderId: "223669808651",
  appId: "1:223669808651:web:7faa06a79f4a187262210e"
};

      const app = initializeApp(firebaseConfig);
      const db = getDatabase(app);
      const selectionRef = ref(db, "selection");
      const scoresRef = ref(db, "scores");

      // Team selection logic
      const redTeamButton = document.getElementById("red-team");
      const blueTeamButton = document.getElementById("blue-team");
      const studentNameSelect = document.getElementById("student-name");
      const worksheetDiv = document.getElementById("worksheet");
      const submitButton = document.getElementById("submit-button");

      let selectedTeam = null;
      let selectedStudent = null;

      redTeamButton.addEventListener("click", () => {
        if (selectedStudent) {
          set(ref(db, `students/${selectedStudent}/team`), "red");
          redTeamButton.classList.add("selected");
          blueTeamButton.classList.remove("selected");
        }
      });

      blueTeamButton.addEventListener("click", () => {
        if (selectedStudent) {
          set(ref(db, `students/${selectedStudent}/team`), "blue");
          blueTeamButton.classList.add("selected");
          redTeamButton.classList.remove("selected");
        }
      });

      studentNameSelect.addEventListener("change", (event) => {
        selectedStudent = event.target.value;

        if (selectedStudent) {
          onValue(ref(db, `students/${selectedStudent}/team`), (snapshot) => {
            const team = snapshot.val();
            selectedTeam = team;
            redTeamButton.classList.toggle("selected", team === "red");
            blueTeamButton.classList.toggle("selected", team === "blue");
          });
        }
      });

      // Worksheet logic
      questions.forEach((question, index) => {
        const questionElement = document.createElement("div");
        questionElement.innerHTML = `
          <p>${question.question}</p>
          <select data-correct-answer="${question.correctAnswer}" data-question-index="${index}">
            <option value="">Select answer</option>
            ${question.wordBank
              .map(
                (answer) =>
                  `<option value="${answer}">${answer}</option>`
              )
              .join("")}
          </select>
          <button class="answer-button">Submit Answer</button>
        `;
        worksheetDiv.appendChild(questionElement);
      });

      worksheetDiv.addEventListener("click", (event) => {
  if (!event.target.classList.contains("answer-button")) return;
  const selectElement = event.target.previousSibling;
  const correctAnswer = selectElement.dataset.correctAnswer;
  const selectedAnswer = selectElement.value;
  const questionIndex = selectElement.dataset.questionIndex;
  const teamColor = selectedTeam === "red" ? "red" : "blue";

  // Check if answer is correct and update scores
  if (selectedAnswer === correctAnswer) {
    saveScore(questionIndex);
    event.target.style.backgroundColor = teamColor;
    selectElement.disabled = true;
  } else {
    event.target.style.backgroundColor = "grey";
  }
});


      // Save score to Firebase
      function saveScore(questionIndex) {
  if (!selectedStudent || !selectedTeam) return;

  const studentRef = ref(scoresRef, `${selectedStudent}/${selectedTeam}`);
  const questionRef = ref(studentRef, `${questionIndex}`);

  set(questionRef, true);

  // Calculate and update team score
  let teamScoreElement;
  if (selectedTeam === "red") {
    scores.red += 1;
    teamScoreElement = document.getElementById("red-score");
  } else {
    scores.blue += 1;
    teamScoreElement = document.getElementById("blue-score");
  }
  teamScoreElement.textContent = scores[selectedTeam];
}


      // Load individual and team scores from Firebase
     
      onValue(scoresRef, (snapshot) => {
        const data = snapshot.val();
        if (!data) return;

        // Update individual scores
        const scores = {
  red: 0,
  blue: 0
};
const submitButton = document.getElementById("submit-button");

        
        const individualScoresList = document.getElementById(
          "individual-scores"
        );
        individualScoresList.innerHTML = "";
        Object.entries(data).forEach(([student, scores]) => {
          const studentScoreElement = document.createElement("li");
          studentScoreElement.innerHTML = `${student}: ${Object.values(
            scores
          ).filter(Boolean).length} / ${questions.length}`;
          individualScoresList.appendChild(studentScoreElement);
        });

        // Update team scores
        scores.red = Object.values(data)
          .map((scores) => scores.red)
          .filter(Boolean).length;
        scores.blue = Object.values(data)
          .map((scores) => scores.blue)
          .filter(Boolean).length;
        document.getElementById("red-score").textContent = scores.red;
        document.getElementById("blue-score").textContent = scores.blue;
      });
    </script>
  </body>
</html>

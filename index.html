<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Worksheet</title>
    <style>
      .team-button {
        padding: 5px 10px;
        margin-right: 5px;
        background-color: grey;
        border: none;
        color: white;
        cursor: pointer;
      }

      .selected {
        background-color: green;
      }

      .worksheet-question {
        margin-bottom: 10px;
      }

      .answer-button {
        margin-left: 10px;
        padding: 5px 10px;
        background-color: grey;
        border: none;
        color: white;
        cursor: pointer;
      }

      .answered {
        background-color: green;
      }

      .correct-answer {
        background-color: green;
      }

      .wrong-answer {
        background-color: red;
      }
    </style>
  </head>
  <body>
    <div>
      <h1>Worksheet</h1>
      <p>Select your team:</p>
      <button id="red-team" class="team-button">Red</button>
      <button id="blue-team" class="team-button">Blue</button>
    </div>
    <div>
      <p>Select your name:</p>
      <select id="student-name">
        <option value="">Select name</option>
        <option value="Jane">Jane</option>
        <option value="John">John</option>
      </select>
    </div>
    <div id="worksheet"></div>
    <button id="submit-button">Submit Answers</button>
    <div>
      <h2>Individual Scores</h2>
      <ul id="individual-scores"></ul>
    </div>
    <div>
      <h2>Team Scores</h2>
      <p>Red Team: <span id="red-score">0</span></p>
      <p>Blue Team: <span id="blue-score">0</span></p>
    </div>

    <script type="module">
      import { initializeApp } from "https://www.gstatic.com/firebasejs/9.18.0/firebase-app.js";
      import { getDatabase, ref, set, onValue, push } from "https://www.gstatic.com/firebasejs/9.18.0/firebase-database.js";

      const firebaseConfig = {
  apiKey: "AIzaSyC6toyds2tLzyfiINLUXgPeEgSDU2WhwkI",
  authDomain: "worksheet-9f4d8.firebaseapp.com",
  databaseURL: "https://worksheet-9f4d8-default-rtdb.firebaseio.com",
  projectId: "worksheet-9f4d8",
  storageBucket: "worksheet-9f4d8.appspot.com",
  messagingSenderId: "223669808651",
  appId: "1:223669808651:web:7faa06a79f4a187262210e"
};

      const app = initializeApp(firebaseConfig);
      const db = getDatabase(app);

      const questions = [
  {
    question: "What is the smallest particle of matter?",
    correctAnswer: "Atom",
    wordBank: ["Molecule", "Electron", "Proton", "Atom"],
  },
  {
    question: "What is the largest animal in the world?",
    correctAnswer: "Blue Whale",
    wordBank: ["Elephant", "Blue Whale", "Giraffe", "Hippopotamus"],
  },
  {
    question: "What planet is known as the Red Planet?",
    correctAnswer: "Mars",
    wordBank: ["Jupiter", "Mars", "Venus", "Mercury"],
  },
];

// Get elements from the DOM
const redTeamButton = document.getElementById("red-team");
const blueTeamButton = document.getElementById("blue-team");
const studentNameSelect = document.getElementById("student-name");
const worksheetDiv = document.getElementById("worksheet");
const submitButton = document.getElementById("submit-button");
const individualScoresElement = document.getElementById("individual-scores");
const redScoreElement = document.getElementById("red-score");
const blueScoreElement = document.getElementById("blue-score");

// Variables to keep track of state
let selectedTeam = null;
let selectedStudent = null;

// Reference to Firebase Database
const selectionRef = ref(db, "selection");
const scoresRef = ref(db, "scores");

// Functions to update student/team selection in Firebase Database
function selectTeam(team) {
  if (selectedStudent) {
    set(ref(db, `students/${selectedStudent}/team`), team)
      .then(() => {
        console.log(`Selected team for ${selectedStudent}: ${team}`);
      })
      .catch((error) => {
        console.error(`Error selecting team for ${selectedStudent}:`, error);
      });
    redTeamButton.classList.toggle("selected", team === "red");
    blueTeamButton.classList.toggle("selected", team === "blue");
    selectedTeam = team;
  }
}

function selectStudent(student) {
  selectedStudent = student;
  onValue(ref(db, `students/${selectedStudent}/team`), (snapshot) => {
    const team = snapshot.val();
    selectedTeam = team;
    redTeamButton.classList.toggle("selected", team === "red");
    blueTeamButton.classList.toggle("selected", team === "blue");
  });
}

// Listen for team selection events
redTeamButton.addEventListener("click", () => {
  selectTeam("red");
});

blueTeamButton.addEventListener("click", () => {
  selectTeam("blue");
});

studentNameSelect.addEventListener("change", (event) => {
  selectStudent(event.target.value);
});

// Render questions on the worksheet
questions.forEach((question, index) => {
  const questionElement = document.createElement("div");
  questionElement.innerHTML = `
    <p>${question.question}</p>
    <select data-correct-answer="${question.correctAnswer}" data-question-index="${index}">
      <option value="">Select answer</option>
      ${question.wordBank
        .map(
          (answer) =>
            `<option value="${answer}">${answer}</option>`
        )
        .join("")}
    </select>
    <button class="answer-button">Submit Answer</button>
  `;
  worksheetDiv.appendChild(questionElement);
});

worksheetDiv.addEventListener("click", (event) => {
  if (!event.target.classList.contains("answer-button")) return;
  const selectElement = event.target.previousSibling;
  const correctAnswer = selectElement.dataset.correctAnswer;
  const selectedAnswer = selectElement.value;
  const questionIndex = selectElement.dataset.questionIndex;
  const teamColor = selectedTeam === "red" ? "red" : "blue";

  // Check if answer is correct and update scores
  if (selectedAnswer === correctAnswer) {
    saveScore(questionIndex, selectedAnswer);
    event.target.style.backgroundColor = teamColor;
    selectElement.disabled = true;
  } else {
    saveScore(questionIndex, selectedAnswer);
    event.target.style.backgroundColor = "grey";
  }

  // Disable the submit button after clicking
  event.target.disabled = true;
  event.target.classList.add("answered");
  selectElement.disabled = true;

  // Highlight the correct and incorrect answers
  const options = selectElement.options;
  for (let i = 0; i < options.length; i++) {
    const option = options[i];
    if (option.value === correctAnswer) {
      option.classList.add("correct-answer");
    } else if (option.value === selectedAnswer) {
      option.classList.add("wrong-answer");
    }
  }
});

  if (!event.target.classList.contains("answer-button")) return;
  

  // Check if answer is correct and update scores
  if (selectedAnswer === correctAnswer) {
    saveScore(questionIndex, selectedAnswer, correctAnswer);
    event.target.style.backgroundColor = teamColor;
    selectElement.disabled = true;
  } else {
    event.target.style.backgroundColor = "grey";
  }

  // Disable the submit button after clicking
  event.target.disabled = true;
  event.target.classList.add("answered");
  selectElement.disabled = true;

  // Highlight the correct and incorrect answers
 
  for (let i = 0; i < options.length; i++) {
    const option = options[i];
    if (option.value === correctAnswer) {
      option.classList.add("correct-answer");
    } else if (option.value === selectedAnswer) {
      option.classList.add("wrong-answer");
    }
  }
;

  if (!event.target.classList.contains("answer-button")) return;
  const selectElement = event.target.previousSibling;
  const correctAnswer = selectElement.dataset.correctAnswer;
  const selectedAnswer = selectElement.value;
  const questionIndex = selectElement.dataset.questionIndex;
  const teamColor = selectedTeam === "red" ? "red" : "blue";

  // Check if answer is correct and update scores
  if (selectedAnswer === correctAnswer) {
    saveScore(questionIndex);
    event.target.style.backgroundColor = teamColor;
    selectElement.disabled = true;
  } else {
    event.target.style.backgroundColor = "grey";
  }

  // Disable the submit button after clicking
  event.target.disabled = true;
  event.target.classList.add("answered");
  selectElement.disabled = true;

  // Highlight the correct and incorrect answers
  const options = selectElement.options;
  for (let i = 0; i < options.length; i++) {
    const option = options[i];
    if (option.value === correctAnswer) {
option.classList.add("correct-answer");
} else if (option.value === selectedAnswer) {
option.classList.add("wrong-answer");
}
}
;

// Save score to database
function saveScore(questionIndex, selectedAnswer, correctAnswer) {
  if (selectedTeam) {
    const scoreRef = push(scoresRef);
    set(scoreRef, {
      team: selectedTeam,
      student: selectedStudent,
      question: questionIndex,
      answer: answer,
      selectedAnswer: selectedAnswer,
      correctAnswer: correctAnswer,
      timestamp: Date.now(),
    })
      .then(() => {
        console.log("Score saved successfully");
      })
      .catch((error) => {
        console.error("Error saving score:", error);
      });
  }
}


// Display individual and team scores
onValue(scoresRef, (snapshot) => {
  const scores = snapshot.val();
  individualScoresElement.innerHTML = "";
  let redScore = 0;
  let blueScore = 0;
  Object.entries(scores).forEach(([key, value]) => {
    const { team, student, question } = value;
    const questionText = questions[question].question;
    const isCorrect = questions[question].correctAnswer === value.answer;
    const scoreElement = document.createElement("li");
    scoreElement.innerHTML = `${student}: ${isCorrect ? 1 : 0} point${
      isCorrect ? "" : "s"
    } for "${questionText}"`;
    individualScoresElement.appendChild(scoreElement);

    if (team === "red") {
      redScore += isCorrect ? 1 : 0;
    } else if (team === "blue") {
      blueScore += isCorrect ? 1 : 0;
    }
  });

  redScoreElement.innerText = redScore;
  blueScoreElement.innerText = blueScore;
});

const scores = snapshot.val();
individualScoresElement.innerHTML = "";
let redScore = 0;
let blueScore = 0;
Object.entries(scores).forEach(([key, value]) => {
const { team, student, question } = value;
const questionText = questions[question].question;
const isCorrect =
questions[question].correctAnswer ===
selectElement.options[selectElement.selectedIndex].value;
const scoreElement = document.createElement("li");
  scoreElement.innerHTML = `${student}: ${
    isCorrect ? 1 : 0
  } point${isCorrect ? "" : "s"} for "${questionText}"`;
  individualScoresElement.appendChild(scoreElement);

  if (team === "red") {
    redScore += isCorrect ? 1 : 0;
  } else if (team === "blue") {
    blueScore += isCorrect ? 1 : 0;
  }
});

redScoreElement.innerText = redScore;
blueScoreElement.innerText = blueScore;
;
</script>

</body>
</html>


<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Team Worksheet</title>
    <script src="https://www.gstatic.com/firebasejs/9.6.1/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.6.1/firebase-database-compat.js"></script>
    <style>
      .selected {
        border: 2px solid;
      }
    </style>
  </head>
  <body>
    <div id="team-selection">
      <button id="red-team">Red Team</button>
      <button id="blue-team">Blue Team</button>
      <select id="student-name">
        <option value="">Select student</option>
        <!-- Add student names here -->
        <option value="John">John</option>
        <option value="Jane">Jane</option>
        <option value="Mike">Mike</option>
      </select>
    </div>

    <div id="worksheet">
      <!-- Fill-in-the-blank questions with word bank dropdowns go here -->
    </div>

    <div id="results">
      <h3>Individual Scores</h3>
      <ul id="individual-scores"></ul>
      <h3>Team Scores</h3>
      <span>Red Team: <span id="red-score">0</span></span>
      <span>Blue Team: <span id="blue-score">0</span></span>
    </div>

    <script type="module">
      import { initializeApp } from "https://www.gstatic.com/firebasejs/9.18.0/firebase-app.js";
      import { getDatabase, ref, set, onValue, push } from "https://www.gstatic.com/firebasejs/9.18.0/firebase-database.js";

      const firebaseConfig = {
        // Your Firebase config here
      };

      const app = initializeApp(firebaseConfig);
      const db = getDatabase(app);

      // Team selection logic
      redTeamButton = document.getElementById("red-team");
      blueTeamButton = document.getElementById("blue-team");
      studentNameSelect = document.getElementById("student-name");
      worksheetDiv = document.getElementById("worksheet");

      let selectedTeam = null;
      let selectedStudent = null;

      redTeamButton.addEventListener("click", () => {
        if (selectedStudent) {
          set(ref(db, `students/${selectedStudent}/team`), "red");
          redTeamButton.classList.add("selected");
          blueTeamButton.classList.remove("selected");
        }
      });

      blueTeamButton.addEventListener("click", () => {
        if (selectedStudent) {
          set(ref(db, `students/${selectedStudent}/team`), "blue");
          blueTeamButton.classList.add("selected");
          redTeamButton.classList.remove("selected");
        }
      });

      studentNameSelect.addEventListener("change", (event) => {
        selectedStudent = event.target.value;

        if (selectedStudent) {
          onValue(ref(db, `students/${selectedStudent}/team`), (snapshot) => {
            const team = snapshot.val();
            selectedTeam = team;
            redTeamButton.classList.toggle("selected", team === "red");
            blueTeamButton.classList.toggle("selected", team === "blue");
          });
        }
      });

      // Sample questions and answers
      const questions = [
        {
          question:
            "The Skeletal System is made of ___ bones and the connective tissue.",
          correctAnswer: "206",
          wordBank: ["200", "206", "215"],
        },
        {
          question: "Cartilage is a type of ___ connective tissue.",
          correctAnswer: "strong, flexible",
          wordBank: ["rigid, inflexible", "strong, flexible", "elastic, stretchy"],
        },
        {
          question: "A ___ is a band of fibrous, slightly elastic connective tissue that attaches one bone to another.",
          correctAnswer: "ligament",
          wordBank: ["tendon", "ligament", "cartilage"],
        },
        {
          question: "The ___ muscles are attached to bones and cause body movements.",
          correctAnswer: "skeletal",
          wordBank: ["smooth", "skeletal", "cardiac"],
        },
        {
          question: "The ___ is the largest and most complex part of the brain.",
          correctAnswer: "cerebrum",
          wordBank: ["cerebellum", "cerebrum", "brain stem"],
        },
        {
          question: "The Peripheral Nervous System consists of the ___ and the ___ nervous systems.",
          correctAnswer: "autonomic, somatic",
          wordBank: ["central, peripheral", "autonomic, somatic", "sympathetic, parasympathetic"],
        },
      ];

      // Variables to store the selected team, student name, and the scores
     
      const scores = {
        red: 0,
        blue: 0,
      };

      // Team selection logic
      const redTeamButton = document.getElementById("red-team");
      const blueTeamButton = document.getElementById("blue-team");
      const studentNameSelect = document.getElementById("student-name");

      redTeamButton.addEventListener("click", () => {
        selectedTeam = "red";
        redTeamButton.classList.add("selected");
        blueTeamButton.classList.remove("selected");
        saveSelection();
      });

      blueTeamButton.addEventListener("click", () => {
        selectedTeam = "blue";
        blueTeamButton.classList.add("selected");
        redTeamButton.classList.remove("selected");
        saveSelection();
      });

      studentNameSelect.addEventListener("change", (event) => {
        selectedStudent = event.target.value;
        saveSelection();
      });

      function saveSelection() {
        if (selectedTeam && selectedStudent) {
          const selectionRef = ref(db, "selection");
          set(selectionRef, {
            team: selectedTeam,
            student: selectedStudent,
          });
          redTeamButton.disabled = true;
          blueTeamButton.disabled = true;
          studentNameSelect.disabled = true;
        }
      }

      // Worksheet logic
      const worksheetDiv = document.getElementById("worksheet");
      questions.forEach((question, index) => {
        const questionElement = document.createElement("div");
        questionElement.innerHTML = `
          <p>${question.question}</p>
          <select data-correct-answer="${question.correctAnswer}" data-question-index="${index}">
            <option value="">Select answer</option>
            ${question.wordBank
              .map(
                (answer) =>
                  `<option value="${answer}">${answer}</option>`
              )
              .join("")}
          </select>
          <button class="answer-button">Submit Answer</button>
        `;
        worksheetDiv.appendChild(questionElement);
      });

      worksheetDiv.addEventListener("click", (event) => {
        if (event.target.tagName !== "BUTTON") return;
        const selectElement = event.target.previousSibling;
        correctAnswer = select        
        const correctAnswer = selectElement.dataset.correctAnswer;
        const selectedAnswer = selectElement.value;
        const questionIndex = selectElement.dataset.questionIndex;
        const teamColor = selectedTeam === "red" ? "red" : "blue";

        // Check if answer is correct and update scores
        if (selectedAnswer === correctAnswer) {
          saveScore(questionIndex);
          event.target.style.backgroundColor = teamColor;
          selectElement.disabled = true;
        } else {
          event.target.style.backgroundColor = "grey";
        }
      });

      // Save score to Firebase
      function saveScore(questionIndex) {
        if (!selectedStudent || !selectedTeam) return;

        const studentRef = ref(scoresRef, `${selectedStudent}/${selectedTeam}`);
        const questionRef = ref(studentRef, `${questionIndex}`);

        set(questionRef, true);
      }


